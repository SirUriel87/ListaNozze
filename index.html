<!DOCTYPE html>
<html lang="it">
<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lista nozze ‚Äì Esperienze in Giappone</title>
  <style>
    :root {
      --pointInitSize: 30px;
      --highlightColor: #7a7a7a;
      --highlightActiveColor: #008bf8;
    }

    body {
      margin: 0;
      font-family: sans-serif;
      background: #fdf7f2;
      padding: 1rem;
    }


    .container {
      position: relative;
      max-width: 900px;
      margin: 0 auto;
      --city-radius: 2rem;
      --city-sign-color-back: var(--highlightActiveColor);
      --city-sign-color-font: #fff;
      --city-pin-size-font: 2rem;
      width: calc(100% - 300px); /* Lascia spazio per la sidebar */
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .sidebar {
        position: static;
        width: 100%;
        margin-top: 30px;
        transform: none;
      }
      .container {
        width: 100%;
      }
    }

    .map {
      width: 100%;
      display: block;
    }


    /* #region Cart Sidebar */

    .sidebar {
      position: fixed;
      right: 20px;
      top: 20px; /* Fissa la distanza dal top */
      width: 250px;
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      z-index: 100;
      max-height: calc(100vh - 40px); /* Altezza massima basata sulla viewport */
      overflow-y: auto; /* Abilita lo scroll se il contenuto √® troppo lungo */
      
      /* Rimuovi la trasformazione che centrava verticalmente */
      transform: none !important; 
    }

    .selected-activities {
      margin: 15px 0;
      border-top: 1px solid #eee;
      border-bottom: 1px solid #eee;
      padding: 10px 0;
    }

    .delete-btn {
      background: #ffebee;
      border: none;
      border-radius: 50%;
      color: #ff4444;
      cursor: pointer;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      margin-left: 10px;
      transition: all 0.2s;
    }

    .delete-btn:hover {
      background: #ffcdd2;
      color: #d32f2f;
      transform: rotate(90deg);
    }

    .activity-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px dashed #eee;
    }

    .activity-info {
      flex: 1;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .checkout-btn {
      width: 100%;
      padding: 12px;
      background: var(--highlightActiveColor);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }

    .checkout-btn:hover {
      background: #00d45a;
      transform: translateY(-2px);
    }

    /* #endregion Cart Sidebar */

    /* #region Map - Cities */
    .map-cities {
      width: 100%;
    }
    .map-city {
      border-radius: var(--city-radius);
      left: calc(var(--x) * 1% - var(--city-radius));
      padding: var(--city-radius);
      position: absolute;
      top: calc(var(--y) * 1% - var(--city-radius));
    }
    .map-city::after,
    .map-city::before {
      font-size: var(--city-pin-size-font);
    }
    .map-city::before {
      content: "‚Ä¢";
      left: calc(-50% + var(--city-radius));
      position: absolute;
      top: calc(-0.36em + var(--city-radius));
      text-align: center;
      text-shadow: 0 1px 1px #000;
      width: 100%;
    }
    .map-city::after {
      clip-path: inset(-0.5em 0 0 0);
      content: "üìç";
      text-shadow: 1px 1px 2px var(--highlightColor);
      left: calc(-50% + var(--city-radius));
      position: absolute;
      top: calc(-1em + var(--city-radius));
      text-align: center;
      transition: all 300ms ease-out;
      width: 100%;
      z-index: var(--y);
    }

    /* #endregion Map - Cities */


    /* #region Map - Sign */
    .map-city__label {
      display: none;
      left: calc(-5em + 50%);
      position: absolute;
      text-align: center;
      width: 10em;
      z-index: 999;
    }
    .map-city__sign {
      align-items: center;
      background-color: var(--city-sign-color-back);
      border-radius: 0.2rem;
      border: 0.15em solid var(--city-sign-color-font);
      box-shadow: 0 0 3px #000;
      color: var(--city-sign-color-font);
      column-gap: 0.3em;
      display: flex;
      font-weight: 700;
      justify-content: center;
      margin: 0 auto;
      max-width: 100%;
      overflow: hidden;
      padding: 0.4em 0.6em 0.4em 0.3em;
      text-overflow: ellipsis;
      text-wrap: nowrap;
      width: max-content;
    }
    .map-city__sign::before {
      content: attr(data-icon);
    }

    /* #endregion Map - Sign */


    /* #region tracking */

    /************/
    /* Tracking */
    /************/

    /* Map - Cities */
    .map-city:hover::after {
      clip-path: inset(-0.5em 0 0.5em 0);
      transform: translateY(0.5em);
    }

    /* Map - Sign */
    .map-city:hover .map-city__label {
      animation: fadein 300ms forwards ease-out;
      display: block;
    }

    .map-city:hover .map-city__sign.anim::before {
      animation-duration: 500ms;
      animation-fill-mode: forwards;
    }
    .map-city:hover .map-city__sign.anim-grow::before {
      animation-name: grow;
      animation-timing-function: ease-in;
    }
    .map-city:hover .map-city__sign.anim-slidein::before {
      animation-name: slidein;
      animation-timing-function: ease-out;
    }

    .map-city.hovered::after {
      clip-path: inset(-0.5em 0 0.5em 0);
      transform: translateY(0.5em);
    }

    .map-city.hovered .map-city__label {
      display: block;
      animation: fadein 300ms forwards ease-out;
    }

    /* #endregion tracking */

    /* #region animations */
    /**************/
    /* Animations */
    /**************/

    /* Fade in from top */
    @keyframes fadein {
      0% {
        opacity: 0;
        top: calc(var(--city-radius));
      }

      100% {
        opacity: 1;
        top: calc(var(--city-radius) + var(--city-pin-size-font) / 2);
      }
    }

    /* Grow from the ground */
    @keyframes grow {
      0% {
        transform: translate(0, 200%);
      }

      10% {
        transform: translate(5%, 180%);
      }

      20% {
        transform: translate(-10%, 160%);
      }

      30% {
        transform: translate(15%, 140%);
      }

      40% {
        transform: translate(-5%, 120%);
      }

      50% {
        transform: translate(10%, 100%);
      }

      60% {
        transform: translate(-15%, 80%);
      }

      70% {
        transform: translate(5%, 60%);
      }

      80% {
        transform: translate(0, 40%);
      }

      90% {
        transform: translate(0, 20%);
      }

      100% {
        transform: translate(0, 0);
      }
    }

    /* Slide in from left */
    @keyframes slidein {
      0% {
        transform: translateX(-200%);
      }

      100% {
        transform: translateX(0);
      }
    }
    /* #endregion animations */

    .cards-container {
      display: flex;
      overflow-x: auto;
      gap: 1.5rem;
      padding: 5rem;
      margin-top: 2rem;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      cursor: grab;
      user-select: none;
      scroll-behavior: smooth;
      will-change: scroll-position;
    }

    .cards-container::-webkit-scrollbar {
      display: none;
    }
    .cards-container::-webkit-scrollbar-thumb {
      background: #ccc;
      border-radius: 4px;
    }

    .cards-container.active {
      cursor: grabbing;
    }

    /* #region CARD */

    .card {
      width: 190px;
      height: 254px;
      border-radius: 20px;
      background: #f5f5f5;
      position: relative;
      padding: 1.8rem;
      border: 2px solid #c3c6ce;
      transition: 0.5s ease-out;
      overflow: visible;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      scroll-snap-align: start;
      flex: 0 0 auto;
      scroll-snap-align: start;
      flex: 0 0 auto;
      border-color: var(--highlightColor);
      box-shadow: 0 4px 18px 0 rgba(0, 0, 0, 0.25);
    }

    .card-details {
      color: black;
      gap: 0.5em;
    }

    .text-title {
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 0.5em;
    }

    .text-body {
      color: rgb(134, 134, 134);
      font-size: 0.9em;
    }

    .card-button {
      transform: translate(-50%, 50%);
      width: 60%;
      height: 35px;
      border-radius: 1rem;
      border: none;
      background-color: var(--highlightColor);
      color: #fff;
      font-size: 1.2rem;
      padding: 0.5rem 1rem;
      margin: 8px;
      position: absolute;
      left: 50%;
      bottom: 0;
      opacity: 1;
      transition: 0.3s ease-out;
      text-decoration: none;
      text-align: center;
      align-items: center;
      display: flex;
      justify-content: center;
    }


    .card-button.selected {
      background-color: var(--highlightActiveColor);
    }

    .card-button.selected::after {
      content: none; /* Rimuove l'icona del carrello se presente */
    }

    
    .card:hover {
      border-color: var(--highlightActiveColor);
      transition: 0.3s ease-out;
    }

    .card:hover .card-button {
      background-color: var(--highlightActiveColor);
      
    }

   .card-button::after {
      content: "";
      position: absolute;
      right: -30px; /* Inizia fuori dal bottone */
      top: 43%;
      transform: translateY(-50%);
      transition: all 0.3s ease-out;
      opacity: 0;
      top: calc(50% + 1px); /* Micro-regolazione verticale */
    }

    .card:hover .card-button::after {
      content: "\f07a";
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      font-size: 23px; /* Dimensione fissa in pixel */
       /* width: 20px; Larghezza fissa per allineamento migliore */
      text-align: center; /* Centra l'icona */
      right: 18px; /* Posizione finale dentro il bottone */
      opacity: 1;
    }


    /* #endregion CARD */

    @media (max-width: 600px) {
      .card {
        width: 90%;
      }
    }


  </style>
</head>
<body style="background-color: #8cd0e3;">

  <!-- Lista Carrello -->
  <div class="sidebar">
    <h3>Carrello</h3>
    <div class="selected-activities" id="selected-activities">
      <!-- Le attivit√† selezionate appariranno qui -->
    </div>
    <button class="checkout-btn" id="checkout-btn">Checkout (‚Ç¨<span id="total-amount">0</span>)</button>
  </div>

  <div class="container">
    <img src="japan_map_custom_2.png" alt="Mappa Giappone" class="map">
    
    <!-- Citt√† sulla mappa -->
    <div class="map-city" style="top: 64%; left: 65%;" data-city="Tokyo">
      <div class="map-city__label">
        <span data-icon="üèñÔ∏è" class="map-city__sign"></span>
      </div>
    </div>
    <div class="map-city" style="top: 67%; left: 42%;" data-city="Kyoto">
      <div class="map-city__label">
        <span data-icon="üèñÔ∏è" class="map-city__sign"></span>
      </div>
    </div>
    <div class="map-city" style="top: 71%; left: 24%;" data-city="Hiroshima">
      <div class="map-city__label">
        <span data-icon="üèñÔ∏è" class="map-city__sign"></span>
      </div>
    </div>
  </div>

  <!-- Lista card -->
  <div class="cards-container" id="cards-container"></div>

  <script>
    const staticLink = "https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&business=diprima.ale@gmail.com&currency_code=EUR&amount=%amount%&item_name=%title%";

    const experiences = {
      "Tokyo": {
        title: "Serata sushi a Tokyo",
        description: "Regala una cena tradizionale in un sushi bar storico di Shinjuku!",
        amount: "50"
      },
      "Kyoto": {
        title: "Cerimonia del t√® a Kyoto",
        description: "Un momento zen in un'antica casa da t√® con vista sul giardino giapponese.",
        amount: "100"
      },
      "Hiroshima": {
        title: "Museo della Pace a Hiroshima",
        description: "Un regalo che lascia il segno: visita e riflessione nel cuore della storia.",
        amount: "200"
      },
      // "1": {
      //   title: "Museo della Pace a Hiroshima",
      //   description: "Un regalo che lascia il segno: visita e riflessione nel cuore della storia.",
      //   amount: "200"
      // },
      // "2": {
      //   title: "Museo della Pace a Hiroshima",
      //   description: "Un regalo che lascia il segno: visita e riflessione nel cuore della storia.",
      //   amount: "200"
      // },
      // "3": {
      //   title: "Museo della Pace a Hiroshima",
      //   description: "Un regalo che lascia il segno: visita e riflessione nel cuore della storia.",
      //   amount: "200"
      // },
      // "4": {
      //   title: "Museo della Pace a Hiroshima",
      //   description: "Un regalo che lascia il segno: visita e riflessione nel cuore della storia.",
      //   amount: "200"
      // },
      // "5": {
      //   title: "Museo della Pace a Hiroshima",
      //   description: "Un regalo che lascia il segno: visita e riflessione nel cuore della storia.",
      //   amount: "200"
      // },
      // "6": {
      //   title: "Museo della Pace a Hiroshima",
      //   description: "Un regalo che lascia il segno: visita e riflessione nel cuore della storia.",
      //   amount: "200"
      // },
      // "7": {
      //   title: "Museo della Pace a Hiroshima",
      //   description: "Un regalo che lascia il segno: visita e riflessione nel cuore della storia.",
      //   amount: "200"
      // },
      // "sd": {
      //   title: "Museo della Pace a Hiroshima",
      //   description: "Un regalo che lascia il segno: visita e riflessione nel cuore della storia.",
      //   amount: "200"
      // },
    };

    const container = document.getElementById("cards-container");


    //#region scrolling javascript
    const slider = document.querySelector('.cards-container');

    let isDragging = false;
    let startX = 0;
    let startScrollLeft = 0;
    let currentX = 0;
    let rafId = null;

    function updateScroll() {
      const deltaX = currentX - startX;
      slider.scrollLeft = startScrollLeft - deltaX;
      rafId = requestAnimationFrame(updateScroll);
    }

    slider.addEventListener('mousedown', (e) => {
      isDragging = true;
      slider.classList.add('active');
      startX = e.clientX;
      startScrollLeft = slider.scrollLeft;
      currentX = e.clientX;
      rafId = requestAnimationFrame(updateScroll);
    });

    slider.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      currentX = e.clientX;
    });

    slider.addEventListener('mouseup', () => {
      isDragging = false;
      slider.classList.remove('active');
      cancelAnimationFrame(rafId);
    });

    slider.addEventListener('mouseleave', () => {
      isDragging = false;
      slider.classList.remove('active');
      cancelAnimationFrame(rafId);
    });
    //#endregion scrolling javascript


    /* #region Cart Sidebar Javascript */

    const selectedActivities = [];
    const totalAmountElement = document.getElementById('total-amount');
    const selectedActivitiesContainer = document.getElementById('selected-activities');
    const checkoutBtn = document.getElementById('checkout-btn');

    // Modifica il loop di creazione delle cards per aggiungere il click handler
    for (const city in experiences) {
      const data = experiences[city];
      const url = staticLink.replace("%amount%", data.amount).replace("%title%", encodeURIComponent(data.title));

      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="card-details">
          <div class="text-title">${data.title}</div>
          <div class="text-body">${data.description}</div>
        </div>
        <a class="card-button" href="#" data-city="${city}" data-amount="${data.amount}">${data.amount} ‚Ç¨</a>
      `;

      // Aggiungi event listener per il click
      const button = card.querySelector('.card-button');
      button.addEventListener('click', (e) => {
        e.preventDefault();
        addToItinerary(city, data.title, data.amount);

        // Feedback visivo
        button.classList.toggle('selected');
        if (button.classList.contains('selected')) {
          button.innerHTML = `${data.amount} ‚Ç¨ ‚úì`;
        } else {
          button.innerHTML = `${data.amount} ‚Ç¨`;
        }
      });

      // Highlight city dot on hover
      card.addEventListener("mouseenter", () => {
        const mapCity = document.querySelector(`.map-city[data-city="${city}"]`);
        if (mapCity) mapCity.classList.add("hovered");
      });

      card.addEventListener("mouseleave", () => {
        const mapCity = document.querySelector(`.map-city[data-city="${city}"]`);
        if (mapCity) mapCity.classList.remove("hovered");
      });

      // ... [mantieni gli altri event listener esistenti] ...
      container.appendChild(card);
    }

    function addToItinerary(city, title, amount) {
      // Controlla se l'attivit√† √® gi√† stata aggiunta
      const existingIndex = selectedActivities.findIndex(item => item.city === city);
      
      if (existingIndex >= 0) {
        // Rimuovi se gi√† presente
        selectedActivities.splice(existingIndex, 1);
      } else {
        // Aggiungi nuova attivit√†
        selectedActivities.push({ city, title, amount });
      }
      
      updateSidebar();
    }

    
    
    
    function updateSidebar() {
      selectedActivitiesContainer.innerHTML = '';
      let total = 0;
      
      selectedActivities.forEach((activity, index) => {
        total += parseInt(activity.amount);
        
        const activityElement = document.createElement('div');
        activityElement.className = 'activity-item';
        activityElement.innerHTML = `
          <div class="activity-info">
            <span>${activity.title}</span>
            <span>‚Ç¨${activity.amount}</span>
          </div>
          <button class="delete-btn" data-index="${index}">‚úï</button>
        `;
        selectedActivitiesContainer.appendChild(activityElement);
      });
      
      // Aggiungi event listener ai pulsanti di eliminazione
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const index = e.target.getAttribute('data-index');
          removeActivity(index);
        });
      });
      
      totalAmountElement.textContent = total;
      checkoutBtn.style.display = selectedActivities.length ? 'block' : 'none';
    }

    function removeActivity(index) {
      selectedActivities.splice(index, 1);
      updateSidebar();
      
      // Aggiorna anche lo stato del bottone nella card corrispondente
      updateCardButtons();
    }

    function updateCardButtons() {
      document.querySelectorAll('.card-button').forEach(btn => {
        const city = btn.getAttribute('data-city');
        const isSelected = selectedActivities.some(item => item.city === city);
        
        if (isSelected) {
          btn.classList.add('selected');
          btn.innerHTML = `${btn.getAttribute('data-amount')} ‚Ç¨ ‚úì`;
        } else {
          btn.classList.remove('selected');
          btn.innerHTML = `${btn.getAttribute('data-amount')} ‚Ç¨`;
        }
      });
    }



    // Checkout handler
    checkoutBtn.addEventListener('click', () => {
      if (selectedActivities.length === 0) return;
      
      const totalAmount = selectedActivities.reduce((sum, item) => sum + parseInt(item.amount), 0);
      const itemsList = selectedActivities.map(item => item.title).join(', ');
      
      const checkoutUrl = staticLink
        .replace("%amount%", totalAmount)
        .replace("%title%", encodeURIComponent(`Itinerario: ${itemsList}`));
      
      window.open(checkoutUrl, '_blank');
    });

    /* #endregion Cart Sidebar Javascript */

    document.querySelectorAll('.map-city').forEach(cityEl => {
    const cityName = cityEl.dataset.city;
    const labelSpan = cityEl.querySelector('.map-city__sign');

    if (labelSpan) {
      labelSpan.textContent = cityName;
    }
  });
    
  </script>
</body>
</html>
